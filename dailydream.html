<!--
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£§‚£∂‚¢∂‚£∂‚£Ñ‚†Ä‚£†‚£¥‚£æ‚†ø‚†ø‚£∑‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚£§‚£§‚£Ñ‚£Ä‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ä‚£Ä‚£Ä‚£†‚£æ‚†ã‚†Ä‚†Ä‚†à‚†π‚£ø‚°ü‚†â‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚†ü‚†â‚†â‚†â‚†õ‚†ª‚¢ø‚£∂‚†ø‚†ø‚†ü‚†õ‚†õ‚†õ‚£ø‚†á‚†Ä‚¢†‚£∂‚£∂‚£∂‚£ø‚£∑‚£¶‚£§‚£Ä‚£†‚£§‚£ø‚£∑‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚£ø‚†Ä‚†Ä‚¢∏‚£ø‚£º‚°ø‚†Å‚†Ä‚†Ä‚†ô‚£ø‚£Ø‚°Å‚†Ä‚†à‚¢ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢π‚£ß‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£ø‚£Ñ‚†Ä‚†Ä‚¢ô‚£ø‚£∑‚°Ä‚†Ä‚†Ä‚¢†‚£ø‚£ø‚£ø‚°Ü‚†Ä‚£æ‚°á‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚¢ø‚£ø‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†õ‚†õ‚†õ‚†õ‚†ã‚†ô‚†ª‚†∑‚†æ‚£ø‚°ü‚†õ‚†ã‚†Ä‚£¥‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚†∑‚°∂‚†ø‚†õ‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚£∏‚°ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£π‚£∑‚£§‚£§‚£§‚°Ñ
‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£Ñ‚°Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ã‚¢π‚£ø‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚£Ä‚£Ä‚£§‚£ø‚£ß‚£§‚°Ñ‚†Ä‚†Ä‚†Ä‚¢Ä‚£§‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢ø‚£ø‚°∑‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£º‚£ø‚£§‚£§‚°§‚†Ä
‚†à‚†õ‚†â‚†â‚†π‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†∏‚£ø‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°§‚£§‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£æ‚†è‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚£Ä‚£§‚£ø‚£∑‚†û‚†É‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†∑‚†§‚†º‚£É‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢õ‚£ø‚°ø‚¢∂‚£§‚£Ñ‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†â‚†Å‚†Ä‚†π‚£∑‚£§‚°¥‚†Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£§‚£§‚£§‚£§‚£§‚£º‚°ü‚£ª‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£Ä‚£¥‚°ø‚†ã‚†Ä‚†Ä‚†Ä‚†â‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£†‚°æ‚†ü‚†õ‚†ø‚£∂‚£§‚£§‚£§‚£Ñ‚£∞‚£ø‚£ç‚£Ä‚°Ä‚†Ä‚†à‚†ô‚†≥‚†ø‚¢∑‚£¶‚£Ä‚£†‚£§‚£∂‚£ø‚£ü‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚†ã‚†Ä‚†Ä‚†Ä‚£∞‚°ü‚†â‚†Ä‚†Ä‚†ô‚£ø‚£Ö‚£â‚£ø‚£Å‚£Ä‚£†‚£∂‚°Ä‚†Ä‚†Ä‚†à‚£ø‚°è‚†Å‚†Ä‚†Ä‚†π‚£∑‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚††‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚£ß‚°Ω‚†â‚†õ‚¢â‚£â‚£ò‚£∑‚£Ñ‚£∞‚£ø‚£ø‚†á‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚°Ü‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚£ª‚°∑‚°Ñ‚£û‚£≥‚†ò‚¢¶‚£á‚°à‚†ô‚°ø‚¢ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚¢†‚£ø‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£¥‚°ü‚†â‚¢ø‚£¶‚£Ñ‚£†‚£¥‚°ø‚†õ‚£°‚£å‚£ø‚¢≥‚°û‚†ß‚£ø‚£Ä‚°ô‚†ö‚¢ø‚£¶‚£Ñ‚£§‚£¥‚†ü‚†ô‚¢ø‚°Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚°ø‚†Ä‚†Ä‚†Ä‚†à‚†â‚†â‚¢π‚£ß‚†à‚†≥‚†û‚°â‚¢ª‚°∑‚¢¶‚†∏‚¢≠‚£ß‚£§‚°ø‚†ã‚†â‚†â‚†Ä‚†Ä‚†Ä‚†à‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∏‚£á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚£ø‚£Ü‚†Ä‚¢æ‚£π‚†Ü‚†ô‚¢´‚£∂‚£æ‚°ø‚†ã‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚£ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚£ø‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ò‚¢ø‚£∂‚£§‚£§‚£¥‚£æ‚°ø‚†ª‚£ø‚°á‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢∞‚°ø‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†π‚£∑‚£Ñ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£º‚£ø‚£ø‚°ø‚†ø‚†ø‚£∑‚£∂‚£ø‚£∑‚°Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚¢Ä‚£¥‚°ø‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ª‚¢∑‚£¶‚£§‚£§‚£¥‚°ø‚†ã‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†ô‚¢ø‚£¶‚£§‚£Ä‚£§‚£¥‚°ø‚†õ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†Å‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†â‚†â‚†â‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä               
 _         _       _        _       _   _                         
|_|___ ___| |_ ___| |___   | |_ ___| |_| |_ ___ ___   
| |_ -| .'| . | -_| | .'|  | . | .'| '_| '_| -_|  _|   
|_|___|__,|___|___|_|__,|  |___|__,|_,_|_,_|___|_|                                                   
‚ô°‚Äß‚ÇäÀöüéÄ‡º∫‚ô°‡ºªüéÄÀö‚Çä‚Äß‚ô° ‚ô°‚Äß‚ÇäÀöüéÄ‚ô°‡ºªüéÄÀö‚Çä‚Äß‚ô° ‚ô°‚Äß‚ÇäÀöüéÄ‡º∫‚ô°‡ºªüéÄÀö‚Çä‚Äß‚ô° 
--!>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onira - Di√°rio de Sonhos</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Chart.js (Para o Jornal do Sono) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- 3. Day.js (Para formatar datas) -->
    <script src="https://cdn.jsdelivr.net/npm/dayjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs/locale/pt-br.js"></script>
    
    <!-- 4. Lucide Icons (Para √≠cones) -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.js"></script>
    
    <!-- 5. Estilos e Anima√ß√µes -->
    <style>
        /* Usa uma fonte serifada elegante, como solicitado */
        body {
            font-family: 'Georgia', 'Times New Roman', Times, serif;
            background-color: #0F172A; /* Azul-acinzentado escuro */
        }

        /* Esconde elementos com o atributo 'hidden' */
        [hidden] {
            display: none;
        }

        /* Anima√ß√£o de estrelas piscando */
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.8; }
        }

        .star {
            position: fixed;
            top: 0;
            left: 0;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 6px 2px #E0D1A8; /* Bege-dourado */
            animation: twinkle 4s infinite alternate;
            z-index: 0;
        }
        
        /* Scrollbar suave */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0F172A;
        }
        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Foco em sensa√ß√£o de sonho para cards */
        .dream-card {
            transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        .dream-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 20px rgba(196, 181, 253, 0.1); /* Sombra violeta sutil */
        }
    </style>
</head>

<body class="bg-slate-900 text-gray-300 min-h-screen relative overflow-x-hidden">

    <!-- Cont√™iner para as estrelas de fundo -->
    <div id="star-container" class="absolute inset-0 z-0 pointer-events-none"></div>

    <!-- Cont√™iner principal da aplica√ß√£o -->
    <div class="relative z-10 max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Cabe√ßalho -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-6 pb-4 border-b border-slate-700">
            <h1 class="text-3xl font-bold text-violet-300 mb-4 sm:mb-0">
                üåô Onira
            </h1>
            <nav class="flex flex-wrap justify-center gap-2">
                <button data-view="view-home" class="nav-button bg-slate-800 hover:bg-slate-700 text-violet-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <i data-lucide="home"></i>
                    <span>In√≠cio</span>
                </button>
                <button data-view="view-add" id="nav-add-button" class="nav-button bg-slate-800 hover:bg-slate-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <i data-lucide="plus"></i>
                    <span>Adicionar Sonho</span>
                </button>
                <button data-view="view-journal" class="nav-button bg-slate-800 hover:bg-slate-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <i data-lucide="bar-chart-2"></i>
                    <span>Jornal</span>
                </button>
                <button data-view="view-settings" class="nav-button bg-slate-800 hover:bg-slate-700 text-gray-300 px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                    <i data-lucide="settings"></i>
                    <span>Config.</span>
                </button>
            </nav>
        </header>

        <main>

            <!-- ==== VIS√ÉO 1: IN√çCIO (LISTA DE SONHOS) ==== -->
            <div id="view-home" class="app-view">
                <!-- Filtros e Controles -->
                <div class="mb-6 p-4 bg-slate-800/50 backdrop-blur-sm rounded-lg flex flex-col md:flex-row gap-4">
                    <input id="search-keyword" type="text" placeholder="Buscar por palavra-chave..." class="flex-grow bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-400">
                    
                    <select id="search-emotion" class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400">
                        <option value="">Todas as Emo√ß√µes</option>
                        <!-- Op√ß√µes de emo√ß√£o ser√£o preenchidas por JS -->
                    </select>
                    
                    <input id="search-tag" type="text" placeholder="Filtrar por tag..." class="bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-400">
                </div>
                
                <!-- Controles de Visualiza√ß√£o -->
                <div class="mb-6 flex flex-wrap justify-between items-center gap-4">
                    <div>
                        <button id="view-mode-gallery" class="view-mode-button bg-violet-600 text-white px-3 py-2 rounded-l-lg transition-colors flex items-center gap-2">
                            <i data-lucide="layout-grid"></i>
                            <span>Galeria</span>
                        </button>
                        <button id="view-mode-list" class="view-mode-button bg-slate-700 text-gray-300 px-3 py-2 rounded-r-lg transition-colors flex items-center gap-2">
                            <i data-lucide="list"></i>
                            <span>Lista</span>
                        </button>
                    </div>
                    <button id="random-dream-button" class="bg-amber-600 hover:bg-amber-500 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="shuffle"></i>
                        <span>Sonho Aleat√≥rio</span>
                    </button>
                </div>

                <!-- Cont√™iner dos Sonhos -->
                <div id="dream-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Cards de sonho ser√£o inseridos aqui -->
                    <p id="loading-dreams" class="text-gray-400 col-span-full text-center">Carregando seus sonhos...</p>
                </div>
            </div>

            <!-- ==== VIS√ÉO 2: ADICIONAR/EDITAR SONHO ==== -->
            <div id="view-add" class="app-view hidden">
                <form id="dream-form" class="max-w-2xl mx-auto p-6 bg-slate-800 rounded-lg shadow-lg space-y-4">
                    <h2 id="form-title" class="text-2xl font-bold text-violet-300 mb-4">Novo Sonho</h2>
                    
                    <div>
                        <label for="dream-title" class="block text-sm font-medium text-gray-300 mb-1">T√≠tulo</label>
                        <input type="text" id="dream-title" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="dream-date" class="block text-sm font-medium text-gray-300 mb-1">Data</label>
                            <input type="date" id="dream-date" required class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400">
                        </div>
                        
                        <div>
                            <label for="dream-emotion" class="block text-sm font-medium text-gray-300 mb-1">Emo√ß√£o Principal</label>
                            <select id="dream-emotion" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400">
                                <!-- Op√ß√µes de emo√ß√£o -->
                            </select>
                        </div>
                        
                        <div>
                            <label for="dream-symbol" class="block text-sm font-medium text-gray-300 mb-1">S√≠mbolo (Emoji)</label>
                            <input type="text" id="dream-symbol" maxlength="2" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white text-center focus:outline-none focus:ring-2 focus:ring-violet-400">
                        </div>
                    </div>
                    
                    <div>
                        <label for="dream-description" class="block text-sm font-medium text-gray-300 mb-1">Descri√ß√£o</label>
                        <textarea id="dream-description" rows="8" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="Descreva o que voc√™ se lembra..."></textarea>
                    </div>

                    <div>
                        <label for="dream-tags" class="block text-sm font-medium text-gray-300 mb-1">Tags (separadas por v√≠rgula)</label>
                        <input type="text" id="dream-tags" class="w-full bg-slate-700 border border-slate-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="ex: voar, escola, √°gua">
                    </div>
                    
                    <!-- Bot√µes de A√ß√£o -->
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 pt-4">
                        <div class="flex gap-4">
                            <button type="submit" class="bg-violet-600 hover:bg-violet-500 text-white px-5 py-2 rounded-lg transition-colors flex items-center gap-2">
                                <i data-lucide="save"></i>
                                <span id="save-button-text">Salvar Sonho</span>
                            </button>
                            <button type="button" id="cancel-button" class="bg-slate-600 hover:bg-slate-500 text-gray-200 px-5 py-2 rounded-lg transition-colors">
                                Cancelar
                            </button>
                        </div>
                        
                        <div class="flex gap-4">
                             <button type="button" id="analysis-button" class="bg-amber-600 hover:bg-amber-500 text-white px-5 py-2 rounded-lg transition-colors flex items-center gap-2 hidden">
                                <i data-lucide="sparkles"></i>
                                <span>An√°lise Po√©tica</span>
                            </button>
                            <button type="button" id="delete-button" class="bg-red-700 hover:bg-red-600 text-white px-5 py-2 rounded-lg transition-colors flex items-center gap-2 hidden">
                                <i data-lucide="trash-2"></i>
                                <span>Excluir</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- ==== VIS√ÉO 3: JORNAL DO SONO (GR√ÅFICO) ==== -->
            <div id="view-journal" class="app-view hidden">
                <h2 class="text-2xl font-bold text-violet-300 mb-4">Jornal do Sono</h2>
                <div class="p-4 bg-slate-800 rounded-lg shadow-lg">
                    <p class="text-gray-400 mb-4">Emo√ß√µes mais recorrentes em seus sonhos:</p>
                    <canvas id="journal-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- ==== VIS√ÉO 4: CONFIGURA√á√ïES E EXPORTA√á√ÉO ==== -->
            <div id="view-settings" class="app-view hidden">
                <h2 class="text-2xl font-bold text-violet-300 mb-4">Configura√ß√µes</h2>
                <div class="p-6 bg-slate-800 rounded-lg shadow-lg max-w-md">
                    <h3 class="text-lg font-semibold text-amber-200 mb-2">Exportar Sonhos</h3>
                    <p class="text-gray-400 mb-4">Fa√ßa um backup de todos os seus sonhos em um arquivo JSON.</p>
                    <button id="export-button" class="bg-green-600 hover:bg-green-500 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2">
                        <i data-lucide="download"></i>
                        <span>Exportar para JSON</span>
                    </button>
                    
                    <div class="mt-8 pt-4 border-t border-slate-700">
                         <h3 class="text-lg font-semibold text-amber-200 mb-2">Seu ID de Usu√°rio</h3>
                         <p class="text-gray-400 mb-2 text-sm">Este ID √© √∫nico para sua sess√£o. Seus dados est√£o salvos na nuvem.</p>
                         <p id="user-id-display" class="text-xs text-slate-500 bg-slate-900 p-2 rounded break-all">Carregando...</p>
                    </div>
                </div>
            </div>

        </main>
        
        <!-- ==== MODAL GEN√âRICO (Alertas, An√°lise, Sonho Aleat√≥rio) ==== -->
        <div id="modal-container" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-slate-800 p-6 rounded-lg shadow-2xl max-w-md w-full border border-slate-700">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modal-title" class="text-xl font-bold text-violet-300"></h3>
                    <button id="modal-close-button" class="text-gray-400 hover:text-white">
                        <i data-lucide="x"></i>
                    </button>
                </div>
                <div id="modal-content" class="text-gray-300 mb-6 prose prose-invert prose-p:text-gray-300 prose-headings:text-violet-300">
                    <!-- Conte√∫do do modal -->
                </div>
                <div id="modal-actions" class="flex justify-end gap-4">
                    <button id="modal-cancel-button" class="bg-slate-600 hover:bg-slate-500 text-gray-200 px-4 py-2 rounded-lg transition-colors hidden">
                        Cancelar
                    </button>
                    <button id="modal-confirm-button" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded-lg transition-colors hidden">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>

    </div> <!-- Fim do cont√™iner principal -->


    <!-- ============================================= -->
    <!-- SCRIPT (Firebase e L√≥gica da Aplica√ß√£o)       -->
    <!-- ============================================= -->
    <script type="module">
        // 1. Importa√ß√µes do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            addDoc,
            updateDoc, 
            deleteDoc, 
            onSnapshot, 
            collection, 
            query,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Configura√ß√£o do Day.js
        dayjs.extend(dayjs_plugin_relativeTime);
        dayjs.locale('pt-br');

        // === VARI√ÅVEIS GLOBAIS ===
        let app, auth, db;
        let userId;
        let currentDreams = []; // Cache local dos sonhos
        let currentEditingId = null;
        let currentView = 'view-home';
        let viewMode = 'gallery'; // 'gallery' ou 'list'
        let chartInstance = null;

        // Emo√ß√µes e S√≠mbolos padr√£o
        const emotions = {
            'paz': { 'label': 'Paz', 'symbol': 'üïäÔ∏è', 'color': 'bg-blue-300/10 text-blue-300 border-blue-300/20' },
            'alegria': { 'label': 'Alegria', 'symbol': '‚òÄÔ∏è', 'color': 'bg-yellow-300/10 text-yellow-300 border-yellow-300/20' },
            'medo': { 'label': 'Medo', 'symbol': 'üï∑Ô∏è', 'color': 'bg-purple-300/10 text-purple-300 border-purple-300/20' },
            'tristeza': { 'label': 'Tristeza', 'symbol': 'üíß', 'color': 'bg-indigo-300/10 text-indigo-300 border-indigo-300/20' },
            'raiva': { 'label': 'Raiva', 'symbol': 'üî•', 'color': 'bg-red-300/10 text-red-300 border-red-300/20' },
            'confus√£o': { 'label': 'Confus√£o', 'symbol': 'üåÄ', 'color': 'bg-gray-300/10 text-gray-300 border-gray-300/20' },
            'saudade': { 'label': 'Saudade', 'symbol': '‚è≥', 'color': 'bg-teal-300/10 text-teal-300 border-teal-300/20' },
            'curiosidade': { 'label': 'Curiosidade', 'symbol': 'ü¶ã', 'color': 'bg-green-300/10 text-green-300 border-green-300/20' }
        };

        // === ELEMENTOS DO DOM ===
        const views = document.querySelectorAll('.app-view');
        const navButtons = document.querySelectorAll('.nav-button');
        const dreamForm = document.getElementById('dream-form');
        const dreamContainer = document.getElementById('dream-container');
        const loadingMessage = document.getElementById('loading-dreams');
        const formTitle = document.getElementById('form-title');
        const saveButtonText = document.getElementById('save-button-text');
        
        // Campos do formul√°rio
        const dreamTitle = document.getElementById('dream-title');
        const dreamDate = document.getElementById('dream-date');
        const dreamEmotion = document.getElementById('dream-emotion');
        const dreamSymbol = document.getElementById('dream-symbol');
        const dreamDescription = document.getElementById('dream-description');
        const dreamTags = document.getElementById('dream-tags');
        
        // Bot√µes de a√ß√£o do formul√°rio
        const cancelButton = document.getElementById('cancel-button');
        const deleteButton = document.getElementById('delete-button');
        const analysisButton = document.getElementById('analysis-button');

        // Filtros
        const searchKeyword = document.getElementById('search-keyword');
        const searchEmotion = document.getElementById('search-emotion');
        const searchTag = document.getElementById('search-tag');
        
        // Controles de visualiza√ß√£o
        const viewModeGallery = document.getElementById('view-mode-gallery');
        const viewModeList = document.getElementById('view-mode-list');
        const randomDreamButton = document.getElementById('random-dream-button');
        
        // Configura√ß√µes
        const exportButton = document.getElementById('export-button');
        const userIdDisplay = document.getElementById('user-id-display');

        // Modal
        const modalContainer = document.getElementById('modal-container');
        const modalTitle = document.getElementById('modal-title');
        const modalContent = document.getElementById('modal-content');
        const modalCloseButton = document.getElementById('modal-close-button');
        const modalCancelButton = document.getElementById('modal-cancel-button');
        const modalConfirmButton = document.getElementById('modal-confirm-button');


        // === INICIALIZA√á√ÉO ===
        
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            setupEventListeners();
            populateEmotionSelects();
            renderStars(50);
            lucide.createIcons();
            // Define a data de hoje no formul√°rio
            dreamDate.value = new Date().toISOString().split('T')[0];
        });

        async function initFirebase() {
            try {
                // Carrega configura√ß√£o e ID do app (fornecidos pelo ambiente)
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'onira-default-app';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

                if (!firebaseConfig.apiKey) {
                    console.error("Configura√ß√£o do Firebase n√£o encontrada.");
                    showModal("Erro de Configura√ß√£o", "N√£o foi poss√≠vel carregar a configura√ß√£o do Firebase. Seus dados n√£o ser√£o salvos.");
                    return;
                }
                
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug'); // Para debug no console

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        userIdDisplay.textContent = userId;
                        console.log("Usu√°rio autenticado:", userId);
                        await loadDreams();
                    } else {
                        // Tenta autentica√ß√£o com token customizado ou an√¥nimo
                        try {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                await signInAnonymously(auth);
                            }
                        } catch (authError) {
                            console.error("Erro na autentica√ß√£o:", authError);
                            showModal("Erro de Autentica√ß√£o", "N√£o foi poss√≠vel autenticar. Seus dados n√£o ser√£o salvos.");
                        }
                    }
                });

            } catch (e) {
                console.error("Erro ao inicializar Firebase:", e);
                showModal("Erro Cr√≠tico", "N√£o foi poss√≠vel iniciar a aplica√ß√£o. Verifique o console para mais detalhes.");
            }
        }
        
        // Retorna a refer√™ncia da cole√ß√£o de sonhos do usu√°rio
        function getDreamsCollection() {
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'onira-default-app';
            return collection(db, 'artifacts', appId, 'users', userId, 'dreams');
        }

        // === L√ìGICA DE DADOS (FIRESTORE) ===

        async function loadDreams() {
            if (!userId) return;

            const q = query(getDreamsCollection());
            
            onSnapshot(q, (snapshot) => {
                currentDreams = [];
                snapshot.forEach((doc) => {
                    currentDreams.push({ id: doc.id, ...doc.data() });
                });
                
                // Ordena por data (mais recentes primeiro)
                currentDreams.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                console.log("Sonhos carregados:", currentDreams.length);
                applyFilters(); // Renderiza os sonhos com filtros atuais
                updateJournal(); // Atualiza o gr√°fico
                
            }, (error) => {
                console.error("Erro ao carregar sonhos:", error);
                showModal("Erro de Leitura", "N√£o foi poss√≠vel carregar seus sonhos do banco de dados.");
                loadingMessage.textContent = "Erro ao carregar sonhos.";
            });
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const dreamData = {
                title: dreamTitle.value,
                date: dreamDate.value,
                emotion: dreamEmotion.value,
                symbol: dreamSymbol.value || (emotions[dreamEmotion.value]?.symbol || '‚Ä¢'),
                description: dreamDescription.value,
                tags: dreamTags.value.split(',').map(tag => tag.trim().toLowerCase()).filter(Boolean), // Array de tags
                updatedAt: new Date().toISOString()
            };

            try {
                if (currentEditingId) {
                    // Atualizando sonho existente
                    const docRef = doc(db, getDreamsCollection().path, currentEditingId);
                    await updateDoc(docRef, dreamData);
                    console.log("Sonho atualizado:", currentEditingId);
                } else {
                    // Adicionando novo sonho
                    await addDoc(getDreamsCollection(), {
                        ...dreamData,
                        createdAt: new Date().toISOString()
                    });
                    console.log("Novo sonho salvo");
                }
                
                resetForm();
                navigate('view-home');
                
            } catch (error) {
                console.error("Erro ao salvar sonho:", error);
                showModal("Erro ao Salvar", "N√£o foi poss√≠vel salvar seu sonho. Tente novamente.");
            }
        }
        
        async function deleteDream() {
            if (!currentEditingId) return;

            try {
                const docRef = doc(db, getDreamsCollection().path, currentEditingId);
                await deleteDoc(docRef);
                console.log("Sonho exclu√≠do:", currentEditingId);
                
                resetForm();
                navigate('view-home');
                closeModal();
                
            } catch (error) {
                console.error("Erro ao excluir sonho:", error);
                showModal("Erro ao Excluir", "N√£o foi poss√≠vel excluir seu sonho. Tente novamente.");
            }
        }

        // === L√ìGICA DE RENDERIZA√á√ÉO E UI ===

        function renderDreams(dreamsToRender) {
            dreamContainer.innerHTML = ''; // Limpa o cont√™iner

            if (dreamsToRender.length === 0) {
                loadingMessage.textContent = "Nenhum sonho encontrado. Que tal adicionar um?";
                dreamContainer.appendChild(loadingMessage);
                return;
            }
            
            loadingMessage.textContent = ""; // Limpa msg de loading
            
            // Atualiza classes do cont√™iner com base no modo de visualiza√ß√£o
            if (viewMode === 'list') {
                dreamContainer.className = 'flex flex-col gap-4';
            } else {
                dreamContainer.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';
            }

            dreamsToRender.forEach(dream => {
                const card = (viewMode === 'list') 
                    ? createDreamListElement(dream) 
                    : createDreamCardElement(dream);
                dreamContainer.appendChild(card);
            });
            
            lucide.createIcons(); // Recria √≠cones para os novos elementos
        }

        function createDreamCardElement(dream) {
            const emotion = emotions[dream.emotion] || { label: dream.emotion, symbol: dream.symbol || '‚Ä¢', color: 'bg-gray-300/10 text-gray-300 border-gray-300/20' };
            const card = document.createElement('div');
            card.className = `dream-card bg-slate-800 rounded-lg shadow-lg overflow-hidden cursor-pointer ${emotion.color} border`;
            
            card.innerHTML = `
                <div class="p-5">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-3xl">${emotion.symbol}</span>
                        <span class="text-xs text-gray-400">${dayjs(dream.date).format('DD/MM/YYYY')}</span>
                    </div>
                    <h3 class="text-xl font-semibold text-white truncate mb-2">${dream.title}</h3>
                    <p class="text-gray-400 h-20 overflow-hidden text-ellipsis ...">
                        ${dream.description.substring(0, 100)}${dream.description.length > 100 ? '...' : ''}
                    </p>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="px-2 py-1 text-xs rounded-full ${emotion.color} border">${emotion.label}</span>
                        ${dream.tags.map(tag => `<span class="px-2 py-1 text-xs rounded-full bg-slate-700 text-gray-300">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
            
            card.addEventListener('click', () => showEditForm(dream));
            return card;
        }
        
        function createDreamListElement(dream) {
            const emotion = emotions[dream.emotion] || { label: dream.emotion, symbol: dream.symbol || '‚Ä¢', color: 'bg-gray-300/10 text-gray-300 border-gray-300/20' };
            const card = document.createElement('div');
            card.className = `dream-card bg-slate-800 rounded-lg shadow-lg cursor-pointer flex items-center p-4 gap-4 ${emotion.color} border`;
            
            card.innerHTML = `
                <div class="text-3xl">${emotion.symbol}</div>
                <div class="flex-grow">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-white">${dream.title}</h3>
                        <span class="text-sm text-gray-400">${dayjs(dream.date).format('DD/MM/YYYY')}</span>
                    </div>
                    <p class="text-gray-400 text-sm truncate">
                        ${dream.description.substring(0, 120)}${dream.description.length > 120 ? '...' : ''}
                    </p>
                </div>
                <div class="flex-shrink-0">
                    <span class="px-3 py-1 text-sm rounded-full ${emotion.color} border">${emotion.label}</span>
                </div>
            `;
            
            card.addEventListener('click', () => showEditForm(dream));
            return card;
        }
        
        function updateJournal() {
            if (currentView !== 'view-journal') return; // S√≥ renderiza se a vis√£o estiver ativa

            const ctx = document.getElementById('journal-chart').getContext('2d');
            
            // Processa dados para o gr√°fico
            const emotionCounts = {};
            Object.keys(emotions).forEach(key => emotionCounts[key] = 0);
            
            currentDreams.forEach(dream => {
                if (emotions[dream.emotion]) {
                    emotionCounts[dream.emotion]++;
                }
            });

            const labels = Object.values(emotions).map(e => e.label);
            const data = Object.keys(emotions).map(key => emotionCounts[key]);

            // Destr√≥i gr√°fico antigo se existir
            if (chartInstance) {
                chartInstance.destroy();
            }

            // Cria novo gr√°fico
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'N√∫mero de Sonhos',
                        data: data,
                        backgroundColor: [
                            'rgba(139, 92, 246, 0.4)',  // Violeta
                            'rgba(250, 204, 21, 0.4)',  // Amarelo
                            'rgba(168, 85, 247, 0.4)',  // Roxo
                            'rgba(99, 102, 241, 0.4)',  // Indigo
                            'rgba(239, 68, 68, 0.4)',   // Vermelho
                            'rgba(156, 163, 175, 0.4)', // Cinza
                            'rgba(20, 184, 166, 0.4)',  // Teal
                            'rgba(34, 197, 94, 0.4)',   // Verde
                        ],
                        borderColor: [
                            'rgba(139, 92, 246, 1)',
                            'rgba(250, 204, 21, 1)',
                            'rgba(168, 85, 247, 1)',
                            'rgba(99, 102, 241, 1)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(156, 163, 175, 1)',
                            'rgba(20, 184, 166, 1)',
                            'rgba(34, 197, 94, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#0F172A',
                            titleColor: '#E0D1A8',
                            bodyColor: '#cbd5e1',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8',
                                stepSize: 1
                            },
                            grid: {
                                color: '#334155'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Popula os <select> de emo√ß√µes
        function populateEmotionSelects() {
            const optionsHtml = Object.keys(emotions).map(key => 
                `<option value="${key}">${emotions[key].label}</option>`
            ).join('');
            
            dreamEmotion.innerHTML = optionsHtml;
            searchEmotion.innerHTML = `<option value="">Todas as Emo√ß√µes</option>` + optionsHtml;
        }

        // === NAVEGA√á√ÉO E CONTROLES ===

        function navigate(viewId) {
            views.forEach(view => view.setAttribute('hidden', ''));
            document.getElementById(viewId).removeAttribute('hidden');
            currentView = viewId;
            
            // Atualiza destaque do bot√£o de navega√ß√£o
            navButtons.forEach(button => {
                if (button.dataset.view === viewId) {
                    button.classList.add('bg-slate-700', 'text-violet-300');
                    button.classList.remove('bg-slate-800', 'text-gray-300');
                } else {
                    button.classList.add('bg-slate-800', 'text-gray-300');
                    button.classList.remove('bg-slate-700', 'text-violet-300');
                }
            });
            
            // L√≥gica especial ao entrar em vis√µes
            if (viewId === 'view-journal') {
                updateJournal();
            }
            if (viewId === 'view-add') {
                document.getElementById('nav-add-button').classList.add('bg-slate-700', 'text-violet-300');
                document.getElementById('nav-add-button').classList.remove('bg-slate-800', 'text-gray-300');
            }
        }
        
        function applyFilters() {
            const keyword = searchKeyword.value.toLowerCase();
            const emotion = searchEmotion.value;
            const tag = searchTag.value.toLowerCase();

            const filteredDreams = currentDreams.filter(dream => {
                const titleMatch = dream.title.toLowerCase().includes(keyword);
                const descMatch = dream.description.toLowerCase().includes(keyword);
                const emotionMatch = !emotion || dream.emotion === emotion;
                const tagMatch = !tag || dream.tags.some(t => t.toLowerCase().includes(tag));
                
                return (titleMatch || descMatch) && emotionMatch && tagMatch;
            });

            renderDreams(filteredDreams);
        }

        function showEditForm(dream) {
            resetForm();
            currentEditingId = dream.id;
            
            formTitle.textContent = 'Editar Sonho';
            saveButtonText.textContent = 'Atualizar Sonho';
            dreamTitle.value = dream.title;
            dreamDate.value = dream.date;
            dreamEmotion.value = dream.emotion;
            dreamSymbol.value = dream.symbol;
            dreamDescription.value = dream.description;
            dreamTags.value = dream.tags.join(', ');
            
            deleteButton.removeAttribute('hidden');
            analysisButton.removeAttribute('hidden');
            
            navigate('view-add');
        }

        function resetForm() {
            currentEditingId = null;
            dreamForm.reset();
            dreamDate.value = new Date().toISOString().split('T')[0]; // Reseta data para hoje
            formTitle.textContent = 'Novo Sonho';
            saveButtonText.textContent = 'Salvar Sonho';
            deleteButton.setAttribute('hidden', '');
            analysisButton.setAttribute('hidden', '');
        }
        
        function setViewMode(mode) {
            viewMode = mode;
            if (mode === 'list') {
                viewModeList.classList.add('bg-violet-600', 'text-white');
                viewModeList.classList.remove('bg-slate-700', 'text-gray-300');
                viewModeGallery.classList.add('bg-slate-700', 'text-gray-300');
                viewModeGallery.classList.remove('bg-violet-600', 'text-white');
            } else {
                viewModeGallery.classList.add('bg-violet-600', 'text-white');
                viewModeGallery.classList.remove('bg-slate-700', 'text-gray-300');
                viewModeList.classList.add('bg-slate-700', 'text-gray-300');
                viewModeList.classList.remove('bg-violet-600', 'text-white');
            }
            applyFilters(); // Re-renderiza com o novo modo
        }

        function exportData() {
            try {
                // Remove o ID do usu√°rio dos dados exportados por privacidade
                const exportableData = currentDreams.map(({ id, ...rest }) => rest);
                const dataStr = JSON.stringify(exportableData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `onira_sonhos_${dayjs().format('YYYYMMDD')}.json`;
            
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            } catch (error) {
                console.error("Erro ao exportar:", error);
                showModal("Erro", "N√£o foi poss√≠vel gerar o arquivo de exporta√ß√£o.");
            }
        }

        // === FUNCIONALIDADES B√îNUS ===

        function showRandomDream() {
            if (currentDreams.length === 0) {
                showModal("Ops!", "Voc√™ ainda n√£o tem sonhos registrados para ver um aleat√≥rio.");
                return;
            }
            
            const randomDream = currentDreams[Math.floor(Math.random() * currentDreams.length)];
            const emotion = emotions[randomDream.emotion] || { label: randomDream.emotion, symbol: randomDream.symbol };
            
            const content = `
                <div class="text-center mb-4 text-4xl">${emotion.symbol}</div>
                <p class="text-sm text-gray-400 text-center mb-4">${dayjs(randomDream.date).format('DD [de] MMMM [de] YYYY')}</p>
                <p>${randomDream.description}</p>
                <div class="mt-4 flex flex-wrap gap-2">
                    ${randomDream.tags.map(tag => `<span class="px-2 py-1 text-xs rounded-full bg-slate-700 text-gray-300">${tag}</span>`).join('')}
                </div>
            `;
            
            showModal(`Sonho de ${dayjs(randomDream.date).fromNow()}: ${randomDream.title}`, content);
        }
        
        function generatePoeticAnalysis() {
            const emotionKey = dreamEmotion.value;
            const tags = dreamTags.value.split(',').map(t => t.trim()).filter(Boolean);
            const description = dreamDescription.value.toLowerCase();
            
            let analysis = "Este sonho fala sobre ";

            // L√≥gica simples de interpreta√ß√£o
            const themes = {
                'paz': 'harmonia interior e aceita√ß√£o',
                'alegria': 'realiza√ß√£o e otimismo',
                'medo': 'transforma√ß√£o, o desconhecido e sombras a enfrentar',
                'tristeza': 'libera√ß√£o de sentimentos passados e cura',
                'raiva': 'for√ßa reprimida e a necessidade de limites',
                'confus√£o': 'busca por clareza e novos caminhos',
                'saudade': 'conex√µes profundas e as pontes da mem√≥ria',
                'curiosidade': 'explora√ß√£o e a abertura de novas portas'
            };
            
            analysis += themes[emotionKey] || 'sentimentos complexos';

            if (tags.length > 0) {
                analysis += `, tocando em s√≠mbolos de '${tags[0]}'`;
                if (tags.length > 1) {
                    analysis += ` e '${tags[1]}'`;
                }
            }
            
            if (description.includes('√°gua') || description.includes('rio') || description.includes('mar')) {
                analysis += ". A presen√ßa da √°gua sugere um mergulho no seu subconsciente, nas suas emo√ß√µes mais profundas.";
            } else if (description.includes('voar') || description.includes('c√©u')) {
                analysis += ". A sensa√ß√£o de voar indica um desejo de liberdade, transcend√™ncia e uma nova perspectiva sobre a vida.";
            } else if (description.includes('cair') || description.includes('queda')) {
                analysis += ". A queda pode representar ansiedade ou perda de controle, mas tamb√©m uma entrega ao inevit√°vel.";
            } else if (description.includes('casa') || description.includes('quarto')) {
                analysis += ". A casa simboliza seu eu interior, seu ref√∫gio e sua estrutura ps√≠quica.";
            } else {
                analysis += ". √â um convite para refletir sobre como esses elementos se conectam em sua vida desperta.";
            }

            showModal("An√°lise Po√©tica (Simb√≥lica)", `<p class="italic text-lg text-amber-200/80">${analysis}</p>`);
        }

        // === MODAL ===
        
        // Fun√ß√£o gen√©rica para mostrar o modal
        function showModal(title, content, confirmCallback = null) {
            modalTitle.textContent = title;
            modalContent.innerHTML = content;
            
            // Esconde/mostra bot√µes de a√ß√£o
            modalConfirmButton.classList.toggle('hidden', !confirmCallback);
            modalCancelButton.classList.toggle('hidden', !confirmCallback);
            
            // Remove listeners antigos para evitar chamadas m√∫ltiplas
            const newConfirmButton = modalConfirmButton.cloneNode(true);
            modalConfirmButton.parentNode.replaceChild(newConfirmButton, modalConfirmButton);
            modalConfirmButton = newConfirmButton;
            
            if (confirmCallback) {
                modalConfirmButton.addEventListener('click', confirmCallback);
                modalConfirmButton.classList.remove('hidden');
                modalCancelButton.classList.remove('hidden');
            } else {
                 modalConfirmButton.classList.add('hidden');
                 modalCancelButton.classList.add('hidden');
            }

            modalContainer.classList.remove('hidden');
        }

        function closeModal() {
            modalContainer.classList.add('hidden');
            // Limpa conte√∫do e bot√µes
            modalTitle.textContent = '';
            modalContent.innerHTML = '';
            modalConfirmButton.classList.add('hidden');
            modalCancelButton.classList.add('hidden');
        }
        
        // === EFEITOS VISUAIS ===

        function renderStars(count) {
            const container = document.getElementById('star-container');
            container.innerHTML = ''; // Limpa estrelas existentes
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}vw`;
                star.style.top = `${Math.random() * 100}vh`;
                star.style.animationDelay = `${Math.random() * 4}s`;
                star.style.animationDuration = `${Math.random() * 3 + 2}s`;
                container.appendChild(star);
            }
        }
        
        // === SETUP DE EVENT LISTENERS ===

        function setupEventListeners() {
            // Navega√ß√£o principal
            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const viewId = e.currentTarget.dataset.view;
                    if (viewId === 'view-add') {
                        resetForm();
                        navigate('view-add');
                    } else {
                        navigate(viewId);
                    }
                });
            });

            // Formul√°rio de sonho
            dreamForm.addEventListener('submit', handleFormSubmit);
            cancelButton.addEventListener('click', () => {
                resetForm();
                navigate('view-home');
            });
            
            deleteButton.addEventListener('click', () => {
                showModal(
                    'Excluir Sonho', 
                    `<p>Tem certeza que deseja excluir o sonho "<strong>${dreamTitle.value}</strong>"? Esta a√ß√£o n√£o pode ser desfeita.</p>`,
                    deleteDream // Passa a fun√ß√£o de exclus√£o como callback
                );
            });
            
            analysisButton.addEventListener('click', generatePoeticAnalysis);

            // Atualiza s√≠mbolo ao mudar emo√ß√£o
            dreamEmotion.addEventListener('change', (e) => {
                const selectedEmotion = emotions[e.target.value];
                if (selectedEmotion) {
                    dreamSymbol.value = selectedEmotion.symbol;
                }
            });

            // Filtros da home
            searchKeyword.addEventListener('input', applyFilters);
            searchEmotion.addEventListener('change', applyFilters);
            searchTag.addEventListener('input', applyFilters);
            
            // Controles de visualiza√ß√£o
            viewModeGallery.addEventListener('click', () => setViewMode('gallery'));
            viewModeList.addEventListener('click', () => setViewMode('list'));
            randomDreamButton.addEventListener('click', showRandomDream);
            
            // Configura√ß√µes
            exportButton.addEventListener('click', exportData);
            
            // Modal
            modalCloseButton.addEventListener('click', closeModal);
            modalCancelButton.addEventListener('click', closeModal);
            // Fechar modal ao clicar fora
            modalContainer.addEventListener('click', (e) => {
                if (e.target === modalContainer) {
                    closeModal();
                }
            });
        }
    </script>
</body>
</html>
